<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø³Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
body {
  font-family: 'Press Start 2P', monospace;
  background: url('imag/background.jpg.webp') no-repeat center center fixed;
  background-size: cover;
}
.bg-overlay { 
  background-color: rgba(0,0,0,0.6); 
  min-height: 100vh; 
}
table { border-collapse: collapse; width: 100%; background: white; }
th, td { border: 1px solid #c1a15a; padding: 8px; text-align: center; }
th { background-color: #f5e6b8; }
.summary-box {
  background-color: #fef3c7; /* Ù„ÙˆÙ† Ø®Ù„ÙÙŠØ© Ù…Ù…ÙŠØ² */
  border: 2px solid #c1a15a;
  border-radius: 8px;
  padding: 16px;
  text-align: center;
  font-weight: bold;
  margin: 20px auto;
  width: 50%;
  box-shadow: 0 4px 6px rgba(0,0,0,0.2);
}
</style>
</head>
<body>
<div class="bg-overlay flex flex-col min-h-screen p-6">
  <div class="max-w-4xl mx-auto flex-grow bg-white rounded-lg p-6 shadow-md">
    <header class="flex items-center justify-between mb-6">
      <a href="index.html" class="text-sm border px-3 py-1 rounded hover:bg-gray-200">â¬… Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„ØªØ³ÙˆÙ‚</a>
      <h1 class="text-xl">ğŸ›’ Ø³Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</h1>
    </header>

    <main>
      <table>
        <thead>
          <tr>
            <th>Ø§Ù„Ù…Ù†ØªØ¬</th>
            <th>Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨</th>
            <th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>
            <th>Ø§Ù„Ø³Ø¹Ø± (Ø¯Ø§ÙŠÙ…ÙˆÙ†Ø¯)</th>
            <th>Ø­Ø°Ù</th>
          </tr>
        </thead>
        <tbody id="cartItems"></tbody>
      </table>

      <!-- ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ø¬Ø¯ÙŠØ¯ -->
      <div id="summaryBox" class="summary-box">Ø¥Ø¬Ù…Ø§Ù„ÙŠ: 0 Ø¹Ù†Ø§ØµØ± | 0 Ø¯Ø§ÙŠÙ…ÙˆÙ†Ø¯</div>

      <div class="flex justify-center gap-4 mt-4">
        <button onclick="clearCart()" class="px-4 py-2 bg-red-600 text-white rounded shadow hover:bg-red-700">ğŸ—‘ï¸ Ø¥ÙØ±Ø§Øº Ø§Ù„Ø³Ù„Ø©</button>
        <button onclick="checkout()" class="px-4 py-2 bg-green-500 text-white rounded shadow hover:bg-green-600">âœ” Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨</button>
      </div>

      <!-- Formspree -->
      <form id="orderForm" action="https://formspree.io/f/mdkljklw" method="POST" class="hidden">
        <input type="hidden" name="cart" id="cartInput">
      </form>
    </main>
  </div>
</div>

<script>
const CART_KEY = 'minecraftCart_v1';

function loadCart() {
  let cart = JSON.parse(localStorage.getItem(CART_KEY) || '[]');
  const container = document.getElementById("cartItems");
  const summaryBox = document.getElementById("summaryBox");

  container.innerHTML = "";

  if (cart.length === 0) {
    container.innerHTML = "<tr><td colspan='5' class='text-center py-4'>ğŸ›’ Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©</td></tr>";
    summaryBox.innerText = `Ø¥Ø¬Ù…Ø§Ù„ÙŠ: 0 Ø¹Ù†Ø§ØµØ± | 0 Ø¯Ø§ÙŠÙ…ÙˆÙ†Ø¯`;
    return;
  }

  let totalQuantity = 0;
  let totalPrice = 0;

  cart.forEach((item, index) => {
    const qty = parseInt(item.quantity, 10) || 0;
    const price = Math.ceil(qty / 32);

    totalQuantity += qty;
    totalPrice += price;

    const row = document.createElement('tr');
    row.innerHTML = `
      <td>${item.product}</td>
      <td>${item.name}</td>
      <td>${qty}</td>
      <td>${price}</td>
      <td><button onclick="removeItem(${index})" class="text-red-500">âœ–</button></td>
    `;
    container.appendChild(row);
  });

  summaryBox.innerText = `Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${totalQuantity} Ø¹Ù†Ø§ØµØ± | ${totalPrice} Ø¯Ø§ÙŠÙ…ÙˆÙ†Ø¯`;
}

function removeItem(index) {
  let cart = JSON.parse(localStorage.getItem(CART_KEY) || '[]');
  cart.splice(index, 1);
  localStorage.setItem(CART_KEY, JSON.stringify(cart));
  loadCart();
}

function clearCart() {
  localStorage.removeItem(CART_KEY);
  loadCart();
}

function checkout() {
  let cart = JSON.parse(localStorage.getItem(CART_KEY) || '[]');
  if (cart.length === 0) { alert('Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©'); return; }

  let cartSummary = "";
  cart.forEach(i => {
    cartSummary += `â€¢ ${i.product} - ${i.quantity} (Ø§Ù„Ù„Ø§Ø¹Ø¨: ${i.name})\n`;
  });

  // Ø¥Ø±Ø³Ø§Ù„ Ø¹Ø¨Ø± Formspree
  const form = document.getElementById("orderForm");
  document.getElementById("cartInput").value = cartSummary;
  form.submit();

  // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø³Ù„Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
  localStorage.removeItem(CART_KEY);
  loadCart();
}

window.addEventListener('load', loadCart);
</script>
</body>
</html>
