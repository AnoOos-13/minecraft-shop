<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>سلة المشتريات</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
body {
  font-family: 'Press Start 2P', monospace;
  background: url('imag/background.jpg.webp') no-repeat center center fixed;
  background-size: cover;
}
.bg-overlay { 
  background-color: rgba(0,0,0,0.6); 
  min-height: 100vh; 
}
table { border-collapse: collapse; width: 100%; background: white; }
th, td { border: 1px solid #c1a15a; padding: 8px; text-align: center; }
th { background-color: #f5e6b8; }
.summary-box {
  background-color: #fef3c7; /* لون خلفية مميز */
  border: 2px solid #c1a15a;
  border-radius: 8px;
  padding: 16px;
  text-align: center;
  font-weight: bold;
  margin: 20px auto;
  width: 50%;
  box-shadow: 0 4px 6px rgba(0,0,0,0.2);
}
</style>
</head>
<body>
<div class="bg-overlay flex flex-col min-h-screen p-6">
  <div class="max-w-4xl mx-auto flex-grow bg-white rounded-lg p-6 shadow-md">
    <header class="flex items-center justify-between mb-6">
      <a href="index.html" class="text-sm border px-3 py-1 rounded hover:bg-gray-200">⬅ متابعة التسوق</a>
      <h1 class="text-xl">🛒 سلة المشتريات</h1>
    </header>

    <main>
      <table>
        <thead>
          <tr>
            <th>المنتج</th>
            <th>اسم اللاعب</th>
            <th>الكمية</th>
            <th>السعر (دايموند)</th>
            <th>حذف</th>
          </tr>
        </thead>
        <tbody id="cartItems"></tbody>
      </table>

      <!-- صندوق الملخص الجديد -->
      <div id="summaryBox" class="summary-box">إجمالي: 0 عناصر | 0 دايموند</div>

      <div class="flex justify-center gap-4 mt-4">
        <button onclick="clearCart()" class="px-4 py-2 bg-red-600 text-white rounded shadow hover:bg-red-700">🗑️ إفراغ السلة</button>
        <button onclick="checkout()" class="px-4 py-2 bg-green-500 text-white rounded shadow hover:bg-green-600">✔ إرسال الطلب</button>
      </div>

      <!-- Formspree -->
      <form id="orderForm" action="https://formspree.io/f/mdkljklw" method="POST" class="hidden">
        <input type="hidden" name="cart" id="cartInput">
      </form>
    </main>
  </div>
</div>

<script>
const CART_KEY = 'minecraftCart_v1';

function loadCart() {
  let cart = JSON.parse(localStorage.getItem(CART_KEY) || '[]');
  const container = document.getElementById("cartItems");
  const summaryBox = document.getElementById("summaryBox");

  container.innerHTML = "";

  if (cart.length === 0) {
    container.innerHTML = "<tr><td colspan='5' class='text-center py-4'>🛒 السلة فارغة</td></tr>";
    summaryBox.innerText = `إجمالي: 0 عناصر | 0 دايموند`;
    return;
  }

  let totalQuantity = 0;
  let totalPrice = 0;

  cart.forEach((item, index) => {
    const qty = parseInt(item.quantity, 10) || 0;
    const price = Math.ceil(qty / 32);

    totalQuantity += qty;
    totalPrice += price;

    const row = document.createElement('tr');
    row.innerHTML = `
      <td>${item.product}</td>
      <td>${item.name}</td>
      <td>${qty}</td>
      <td>${price}</td>
      <td><button onclick="removeItem(${index})" class="text-red-500">✖</button></td>
    `;
    container.appendChild(row);
  });

  summaryBox.innerText = `إجمالي: ${totalQuantity} عناصر | ${totalPrice} دايموند`;
}

function removeItem(index) {
  let cart = JSON.parse(localStorage.getItem(CART_KEY) || '[]');
  cart.splice(index, 1);
  localStorage.setItem(CART_KEY, JSON.stringify(cart));
  loadCart();
}

function clearCart() {
  localStorage.removeItem(CART_KEY);
  loadCart();
}

function checkout() {
  let cart = JSON.parse(localStorage.getItem(CART_KEY) || '[]');
  if (cart.length === 0) { alert('السلة فارغة'); return; }

  let cartSummary = "";
  cart.forEach(i => {
    cartSummary += `• ${i.product} - ${i.quantity} (اللاعب: ${i.name})\n`;
  });

  // إرسال عبر Formspree
  const form = document.getElementById("orderForm");
  document.getElementById("cartInput").value = cartSummary;
  form.submit();

  // إزالة السلة بعد الإرسال
  localStorage.removeItem(CART_KEY);
  loadCart();
}

window.addEventListener('load', loadCart);
</script>
</body>
</html>
